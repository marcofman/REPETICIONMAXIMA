<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Método Milón: Nivel 8</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='5' y='20' width='25' height='60' rx='5' fill='%23f59e0b'/><rect x='70' y='20' width='25' height='60' rx='5' fill='%23f59e0b'/><rect x='30' y='20' width='40' height='20' rx='6' fill='%23f59e0b'/><rect x='30' y='60' width='40' height='20' rx='6' fill='%23f59e0b'/></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    body{font-family:'Manrope',sans-serif}
    h1,h2,h3,h4,.font-bebas{font-family:'Bebas Neue',sans-serif;letter-spacing:.05em}
    /* Color principal (Ámbar) */
    .gradient-text{background:linear-gradient(to right,#f59e0b,#fbbf24);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .week-tab-active,.day-tab-active{background-color:#f59e0b;color:#fff}
    .week-tab-inactive,.day-tab-inactive{background-color:#e5e7eb;color:#4b5563}
    .day-checked{background-color:#f59e0b!important;color:#fff!important;border-color:#f59e0b!important}
    .set-checkbox:checked+label{text-decoration:line-through;color:#9ca3af}
    .hidden{display:none}
    .mode-toggle-bg{background-color:#e5e7eb}
    .mode-toggle-btn{background-color:#fff;color:#f59e0b;box-shadow:0 2px 4px rgba(0,0,0,.1);transition:all .3s ease}
    .mode-toggle-btn.active{background-color:#f59e0b;color:#fff;box-shadow:0 4px 6px rgba(0,0,0,.1)}
    .mode-toggle-btn.gym.active{transform:translateX(0%)}
    .mode-toggle-btn.casa.active{transform:translateX(100%)}
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-5xl">

    <header class="text-center mb-10">
      <h1 class="text-6xl md:text-7xl font-extrabold gradient-text">MÉTODO MILÓN</h1>
      <h2 class="text-xl md:text-2xl text-gray-800 font-semibold mt-2 font-bebas">POR PROF. MARCO FLORES</h2>
      <p class="text-lg text-gray-600 mt-2">Nivel 8: El Atleta Completo</p>
      <p class="text-sm text-gray-500 mt-1">La cúspide: Fuerza (L6), Hipertrofia (L5) y Motor (L7) en un solo bloque.</p>
    </header>

    <div class="text-center mb-12 space-y-4 sm:space-y-0 sm:space-x-4">
      <button id="open-guide-btn" class="bg-gray-800 text-amber-400 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-black transition-all duration-300 transform hover:scale-105 font-bebas text-xl">GUÍA ESENCIAL</button>
      <button id="open-theory-btn" class="bg-gray-800 text-amber-400 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-black transition-all duration-300 transform hover:scale-105 font-bebas text-xl">TEORÍA DEL NIVEL 8</button>
    </div>

    <main>
      <section id="workout-view">
        <div id="level-intro-text" class="bg-amber-50 border border-amber-200 text-amber-800 p-4 rounded-lg mb-8 text-center"></div>

        <div id="rutinas">
          <h2 id="workout-title" class="text-4xl text-gray-900 mb-6 text-center"></h2>

          <div id="week-tabs" class="flex justify-center mb-2 border-b-2 border-gray-300"></div>
          <div id="day-tabs" class="flex flex-wrap justify-center mb-6"></div>

          <div class="flex justify-center mb-6">
            <div class="relative w-64 p-1 rounded-lg mode-toggle-bg grid grid-cols-2 gap-1">
              <button id="mode-btn-gym" class="mode-toggle-btn gym relative z-10 w-full py-2 px-4 rounded-md font-bebas text-lg">GIMNASIO</button>
              <button id="mode-btn-casa" class="mode-toggle-btn casa relative z-10 w-full py-2 px-4 rounded-md font-bebas text-lg">CASA</button>
            </div>
          </div>

          <div id="workouts-container" class="space-y-6"></div>
        </div>

        <div id="calendario" class="mt-12">
          <h2 class="text-4xl text-gray-900 mb-6 text-center">Calendario de Seguimiento Semanal</h2>
          <div class="flex justify-center"></div>
        </div>
      </section>
    </main>

    <section id="coach-profile" class="bg-gray-100 p-8 rounded-2xl mt-12">
      <div class="text-center">
        <h3 class="text-3xl text-gray-900">Notas del Coach</h3>
        <p class="text-amber-600 font-semibold mt-1">Prof. Marco Flores</p>
        <p class="text-gray-700 mt-4 max-w-xl mx-auto">Has llegado al final. Este ya no es un "programa", es tu nuevo estándar de rendimiento. La fuerza es inútil si no puedes usarla. La resistencia es inútil si no eres fuerte. Aquí, lo somos todo.</p>
        <blockquote class="mt-6 italic text-gray-600 border-l-4 border-amber-300 pl-4 inline-block text-left">“No entrenes para ser fuerte, o para estar en forma. Entrena para ser ambas cosas, siempre.”</blockquote>
      </div>
    </section>

    <footer class="text-center mt-12 py-6 border-t border-gray-300">
      <h3 class="text-3xl text-gray-900 font-bebas mb-4">Ciclo completado: El estándar es tuyo</h3>
      <h4 class="text-xl font-bebas text-gray-900">Método Milón | Creado por Prof. Marco Flores</h4>
      <p class="text-sm text-gray-600 mb-6">Tu Coach de Recomposición y Rendimiento</p>
      <a href="https://is.gd/milon_master" target="_blank" class="bg-amber-500 text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-amber-600 transition-all duration-300 transform hover:scale-105 font-bebas text-xl inline-flex items-center gap-2">
        <span>IR AL MASTER</span>
      </a>
    </footer>
  </div>

  <div id="guide-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
    <div id="guide-modal-overlay" class="absolute inset-0 bg-black opacity-70"></div>
    <div class="bg-white rounded-2xl shadow-2xl z-10 w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95">
      <div class="p-6 sm:p-8">
        <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
          <h2 id="guide-modal-title" class="text-4xl text-gray-900">Guía Esencial Nivel 8</h2>
          <button id="close-guide-btn" class="text-3xl text-gray-500 hover:text-gray-900 leading-none">&times;</button>
        </div>

        <div id="guide-main-view" class="space-y-6 text-gray-700">
          <div>
            <h3 class="text-2xl text-amber-600 mb-2">Pilar 1: Nutrición de Rendimiento</h3>
            <ul class="list-disc list-inside space-y-2">
              <li><strong>Calorías:</strong> Mantenimiento. Eres una máquina de rendir. Come para sostener el trabajo. Ajusta +/- 200 kcal según tu peso/recuperación.</li>
              <li><strong>Proteína:</strong> 1.8–2.4 g/kg/día. Innegociable.</li>
              <li><strong>Carbohidratos:</strong> Tu combustible de alto octanaje. Consúmelos ANTES (para fuerza) y DESPUÉS (para reponer MetCons) de cada sesión.</li>
              <li><button id="show-carbs-btn" class="text-blue-600 hover:underline text-sm font-semibold">(Ver ideas pre/post)</button></li>
            </ul>
          </div>
          <div>
            <h3 class="text-2xl text-amber-600 mb-2">Pilar 2: La Síntesis Híbrida</h3>
            <ul class="list-disc list-inside space-y-2">
              <li><strong>Días de Fuerza Pura (L6):</strong> Foco en Top Sets (3-5 reps) y Back-Offs (5-8 reps). Descansos largos (2-4 min). Objetivo: fuerza neural.</li>
              <li><strong>Días de Hipertrofia (L5):</strong> Foco en tempos (ej. 3-0-1-0), superseries y Myo-Reps. Descansos cortos/medios (60-90s). Objetivo: estrés metabólico.</li>
              <li><strong>Días de MetCon (L7):</strong> Foco en AMRAPs y EMOMs. Ritmo alto, respiración gestionada. Objetivo: capacidad de trabajo.</li>
            </ul>
          </div>
        </div>

        <div id="guide-carbs-view" class="hidden space-y-4 text-gray-700">
          <div>
            <h3 class="text-2xl text-amber-600 mb-2">Pre (60-90 min) - "Fuerza"</h3>
            <ul class="list-disc list-inside space-y-1">
              <li>Avena + Plátano + Sal</li>
              <li>Comida completa: Arroz + Pollo</li>
            </ul>
          </div>
          <div>
            <h3 class="text-2xl text-amber-600 mb-2">Post (0–60 min) - "Recarga MetCon"</h3>
            <ul class="list-disc list-inside space-y-1">
              <li>Batido: Proteína + Dextrosa/Gatorade</li>
              <li>Arroz blanco + Miel</li>
            </ul>
          </div>
          <div class="pt-4">
            <button id="back-to-guide-btn" class="text-blue-600 hover:underline font-semibold">&larr; Volver</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div id="theory-modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 transition-opacity duration-300">
    <div id="theory-modal-overlay" class="absolute inset-0 bg-black opacity-70"></div>
    <div class="bg-white rounded-2xl shadow-2xl z-10 w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95">
      <div class="p-6 sm:p-8">
        <div class="flex justify-between items-center border-b border-gray-200 pb-4 mb-6">
          <h2 class="text-4xl text-gray-900">¿Qué es "El Atleta Completo"?</h2>
          <button id="close-theory-btn" class="text-3xl text-gray-500 hover:text-gray-900 leading-none">&times;</button>
        </div>
        <div class="space-y-4 text-gray-700">
          <p>Es la síntesis de todo el método Milón. Ya no periodizamos en bloques separados (hipertrofia, luego fuerza, luego motor). Ahora, **ondulamos la carga** dentro de la misma semana.</p>
          <p>Un día entrenas como un Powerlifter (L6), al día siguiente como un Culturista (L5), y al otro como un atleta de CrossFit (L7). Esto requiere una nutrición y recuperación impecables.</p>
          <p class="font-bold text-amber-800">El objetivo ya no es "mejorar en algo", sino "ser bueno en todo". Eres fuerte, tienes músculo y tienes un motor que no se apaga. Eres un atleta completo.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const programData = {
      nivel: 8,
      titulo: 'Nivel 8: El Atleta Completo',
      intro: "La síntesis final. Combinamos fuerza pesada (L6), hipertrofia avanzada (L5) y acondicionamiento metabólico (L7) en una periodización ondulante diaria. Eres un atleta completo. Domina estas 4 semanas.",
      semanas: {
        // ====== SEMANA 1: Adaptación Híbrida (RIR 2) ======
        1: {
          focus: 'Semana 1: Adaptación Híbrida (RIR 2)',
          dias: ['Día 1: Fuerza Pura (L6)', 'Día 2: Hipertrofia Pura (L5)', 'Día 3: Oxidativo Z2', 'Día 4: Motor/MetCon (L7)', 'Día 5: Híbrido Full Body'],
          workouts: {
            0: { // Día 1: Fuerza (L6)
              gym: { exercises: [
                  { name:'Top Set: Press Banca', sets:1, reps:'3-5', rest:'2-4 min', rir:'2', tip:'Calienta bien. Foco neural.' },
                  { name:'Back-Offs: Press Banca', sets:3, reps:'5-8', rest:'2-3 min', rir:'2', tip:'Baja 5-10% del peso.' },
                  { name:'Top Set: Remo con Barra', sets:1, reps:'3-5', rest:'2-4 min', rir:'2', tip:'Espalda recta, pesado.' },
                  { name:'Back-Offs: Remo con Barra', sets:3, reps:'5-8', rest:'2-3 min', rir:'2', tip:'Baja 5-10%.' },
                  { name:'Press Militar (barra)', sets:3, reps:'5-8', rest:'2 min', rir:'2', tip:'Core firme.' },
                ]
              },
              casa: { exercises: [
                  { name:'Top Set: Flexiones (Mochila Pesada)', sets:1, reps:'5-8', rest:'2-3 min', rir:'2', tip:'Máximo peso, RIR 2.' },
                  { name:'Back-Offs: Flexiones (menos peso)', sets:3, reps:'8-12', rest:'2 min', rir:'2', tip:'RIR 2.' },
                  { name:'Top Set: Remo Invertido (Pies elevados)', sets:1, reps:'5-8', rest:'2-3 min', rir:'2', tip:'Mochila en el pecho.' },
                  { name:'Back-Offs: Remo Invertido', sets:3, reps:'8-12', rest:'2 min', rir:'2', tip:'RIR 2.' },
                  { name:'Pike Push-ups (pies elevados)', sets:3, reps:'6-10', rest:'2 min', rir:'2', tip:'Técnica estricta.' },
                ]
              }
            },
            1: { // Día 2: Hipertrofia (L5)
              gym: { exercises: [
                  { name:'Sentadilla Hack (Tempo 3-1-1-0)', sets:4, reps:'8-10', rest:'90s', rir:'2', tip:'Baja 3s, pausa 1s, sube 1s.' },
                  { name:'RDL con Mancuernas (Tempo 3-0-1-0)', sets:4, reps:'10-12', rest:'90s', rir:'2', tip:'Baja en 3s. Siente el estirón.' },
                  { name:'Myo-Reps: Extensiones Cuádriceps', sets:1, reps:'15-20 + 4x(4-5)', rest:'10-15s', rir:'2', tip:'Activación + 4 mini-series.' },
                  { name:'Myo-Reps: Curl Femoral', sets:1, reps:'15-20 + 4x(4-5)', rest:'10-15s', rir:'2', tip:'Activación + 4 mini-series.' },
                  { name:'Elevación Talones (Sentado)', sets:3, reps:'15-20', rest:'60s', rir:'2', tip:'Bombeo.' },
                ]
              },
              casa: { exercises: [
                  { name:'Sentadilla Búlgara (Tempo 3-1-1-0)', sets:4, reps:'10-12 c/u', rest:'90s', rir:'2', tip:'Baja 3s, pausa 1s, sube 1s.' },
                  { name:'RDL a 1 Pierna (Tempo 3-0-1-0)', sets:4, reps:'10-12 c/u', rest:'75s', rir:'2', tip:'Baja en 3s. Equilibrio.' },
                  { name:'Myo-Reps: Sentadilla Goblet (ligera)', sets:1, reps:'20-25 + 4x(5-8)', rest:'15s', rir:'2', tip:'Bombeo de cuádriceps.' },
                  { name:'Curl Nórdico (Negativas)', sets:3, reps:'5-8', rest:'90s', rir:'2', tip:'Baja lo más lento posible.' },
                  { name:'Elevación Talones 1 Pierna', sets:3, reps:'15-20 c/u', rest:'45s', rir:'2', tip:'Bombeo.' },
                ]
              }
            },
            2: { // Día 3: Oxidativo Z2
              gym: { cardio: 'Oxidativo Z2: 30-45 min continuo (bike/remo/cinta). Recuperación activa. Ritmo de conversación.' },
              casa:{ cardio: 'Oxidativo Z2: 30-45 min caminata rápida o bici. Ritmo de conversación. Recuperación activa.' }
            },
            3: { // Día 4: Motor/MetCon (L7)
              gym: { exercises: [
                  { 
                    name:'AMRAP 15 Minutos', sets:1, reps:'AMRAP', rest:'N/A', rir:'N/A', tip:'Tantas rondas como sea posible en 15 min.',
                    subExercises: [
                      { name: 'Kettlebell Swings (24/16kg)', reps: '15' },
                      { name: 'Dominadas (o Remo en anillas)', reps: '10' },
                      { name: 'Push Press con Mancuernas', reps: '10' }
                    ]
                  },
                  { name:'Core: Plancha con Arrastre', sets:3, reps:'8-10 c/u', rest:'60s', rir:'2', tip:'Pesado.' },
                ]
              },
              casa: { exercises: [
                  { 
                    name:'AMRAP 15 Minutos', sets:1, reps:'AMRAP', rest:'N/A', rir:'N/A', tip:'Tantas rondas como sea posible en 15 min.',
                    subExercises: [
                      { name: 'Swings con Mochila', reps: '15' },
                      { name: 'Remo Invertido', reps: '10' },
                      { name: 'Burpees', reps: '8' }
                    ]
                  },
                  { name:'Core: Plancha con Arrastre (mochila)', sets:3, reps:'8-10 c/u', rest:'60s', rir:'2' },
                ]
              }
            },
            4: { // Día 5: Híbrido Full Body
              gym: { exercises: [
                  { name:'Top Set: Peso Muerto', sets:1, reps:'3-5', rest:'3-5 min', rir:'2', tip:'Técnica impecable.' },
                  { name:'Press Inclinado Mancuernas', sets:3, reps:'8-10', rest:'90s', rir:'2', tip:'Controlado.' },
                  { name:'Zancadas con Mancuernas', sets:3, reps:'8-10 c/u', rest:'90s', rir:'2', tip:'Paso largo.' },
                  { name:'Face Pulls', sets:3, reps:'15-20', rest:'60s', rir:'2', tip:'Salud del hombro.' },
                ]
              },
              casa: { exercises: [
                  { name:'Top Set: Puente Glúteos (Pesado)', sets:1, reps:'6-10', rest:'2-3 min', rir:'2', tip:'Pausa 2s arriba.' },
                  { name:'Flexiones Declinadas', sets:3, reps:'10-15', rest:'90s', rir:'2', tip:'Pecho superior.' },
                  { name:'Sentadilla Goblet (Pesada)', sets:3, reps:'10-15', rest:'90s', rir:'2', tip:'Profundidad.' },
                  { name:'Face Pulls (con banda)', sets:3, reps:'15-20', rest:'60s', rir:'2', tip:'Banda dura.' },
                ]
              }
            }
          }
        },

        // ====== SEMANA 2: Sobrecarga (RIR 1-2) ======
        2: {
          focus: 'Semana 2: Sobrecarga Híbrida (RIR 1-2)',
          dias: ['Día 1: Fuerza Pura (L6)', 'Día 2: Hipertrofia Pura (L5)', 'Día 3: Oxidativo Z2', 'Día 4: Motor/MetCon (L7)', 'Día 5: Híbrido Full Body'],
          workouts: {
            0: { // Día 1: Fuerza (L6)
              gym: { exercises: [
                  { name:'Top Set: Press Banca', sets:1, reps:'3-5', rest:'2-4 min', rir:'1-2', tip:'Sube 2.5-5kg. RIR 1-2.' },
                  { name:'Back-Offs: Press Banca', sets:3, reps:'5-8', rest:'2-3 min', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Top Set: Remo con Barra', sets:1, reps:'3-5', rest:'2-4 min', rir:'1-2', tip:'Sube 2.5-5kg. RIR 1-2.' },
                  { name:'Back-Offs: Remo con Barra', sets:3, reps:'5-8', rest:'2-3 min', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Press Militar (barra)', sets:3, reps:'5-8', rest:'2 min', rir:'1-2', tip:'RIR 1-2.' },
                ]
              },
              casa: { exercises: [
                  { name:'Top Set: Flexiones (Mochila Pesada)', sets:1, reps:'5-8', rest:'2-3 min', rir:'1-2', tip:'Más peso. RIR 1-2.' },
                  { name:'Back-Offs: Flexiones (menos peso)', sets:3, reps:'8-12', rest:'2 min', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Top Set: Remo Invertido (Pies elevados)', sets:1, reps:'5-8', rest:'2-3 min', rir:'1-2', tip:'Más peso. RIR 1-2.' },
                  { name:'Back-Offs: Remo Invertido', sets:3, reps:'8-12', rest:'2 min', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Pike Push-ups (pies elevados)', sets:3, reps:'6-10', rest:'2 min', rir:'1-2', tip:'RIR 1-2.' },
                ]
              }
            },
            1: { // Día 2: Hipertrofia (L5)
              gym: { exercises: [
                  { name:'Sentadilla Hack (Tempo 3-1-1-0)', sets:4, reps:'8-10', rest:'90s', rir:'1-2', tip:'Más peso. RIR 1-2.' },
                  { name:'RDL con Mancuernas (Tempo 3-0-1-0)', sets:4, reps:'10-12', rest:'90s', rir:'1-2', tip:'Más peso. RIR 1-2.' },
                  { name:'Myo-Reps: Extensiones Cuádriceps', sets:1, reps:'15-20 + 5x(4-5)', rest:'10-15s', rir:'1-2', tip:'Una mini-serie más.' },
                  { name:'Myo-Reps: Curl Femoral', sets:1, reps:'15-20 + 5x(4-5)', rest:'10-15s', rir:'1-2', tip:'Una mini-serie más.' },
                  { name:'Elevación Talones (Sentado)', sets:3, reps:'15-20', rest:'60s', rir:'1-2', tip:'Más peso.' },
                ]
              },
              casa: { exercises: [
                  { name:'Sentadilla Búlgara (Tempo 3-1-1-0)', sets:4, reps:'10-12 c/u', rest:'90s', rir:'1-2', tip:'Más peso. RIR 1-2.' },
                  { name:'RDL a 1 Pierna (Tempo 3-0-1-0)', sets:4, reps:'10-12 c/u', rest:'75s', rir:'1-2', tip:'Más peso. RIR 1-2.' },
                  { name:'Myo-Reps: Sentadilla Goblet (ligera)', sets:1, reps:'20-25 + 5x(5-8)', rest:'15s', rir:'1-2', tip:'Una mini-serie más.' },
                  { name:'Curl Nórdico (Negativas)', sets:3, reps:'5-8', rest:'90s', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Elevación Talones 1 Pierna', sets:3, reps:'15-20 c/u', rest:'45s', rir:'1-2', tip:'Más peso.' },
                ]
              }
            },
            2: { // Día 3: Oxidativo Z2
              gym: { cardio: 'Oxidativo Z2: 30-45 min continuo (bike/remo/cinta). Recuperación activa. Ritmo de conversación.' },
              casa:{ cardio: 'Oxidativo Z2: 30-45 min caminata rápida o bici. Ritmo de conversación. Recuperación activa.' }
            },
            3: { // Día 4: Motor/MetCon (L7)
              gym: { exercises: [
                  { 
                    name:'AMRAP 18 Minutos', sets:1, reps:'AMRAP', rest:'N/A', rir:'N/A', tip:'Tantas rondas como sea posible en 18 min.',
                    subExercises: [
                      { name: 'Kettlebell Swings (24/16kg)', reps: '15' },
                      { name: 'Dominadas (o Remo en anillas)', reps: '10' },
                      { name: 'Push Press con Mancuernas', reps: '10' }
                    ]
                  },
                  { name:'Core: Plancha con Arrastre', sets:3, reps:'10-12 c/u', rest:'60s', rir:'1-2', tip:'Más peso.' },
                ]
              },
              casa: { exercises: [
                  { 
                    name:'AMRAP 18 Minutos', sets:1, reps:'AMRAP', rest:'N/A', rir:'N/A', tip:'Tantas rondas como sea posible en 18 min.',
                    subExercises: [
                      { name: 'Swings con Mochila', reps: '15' },
                      { name: 'Remo Invertido', reps: '10' },
                      { name: 'Burpees', reps: '8' }
                    ]
                  },
                  { name:'Core: Plancha con Arrastre (mochila)', sets:3, reps:'10-12 c/u', rest:'60s', rir:'1-2' },
                ]
              }
            },
            4: { // Día 5: Híbrido Full Body
              gym: { exercises: [
                  { name:'Top Set: Peso Muerto', sets:1, reps:'3-5', rest:'3-5 min', rir:'1-2', tip:'Sube 2.5-5kg. RIR 1-2.' },
                  { name:'Press Inclinado Mancuernas', sets:3, reps:'8-10', rest:'90s', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Zancadas con Mancuernas', sets:3, reps:'8-10 c/u', rest:'90s', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Face Pulls', sets:3, reps:'15-20', rest:'60s', rir:'1-2', tip:'RIR 1-2.' },
                ]
              },
              casa: { exercises: [
                  { name:'Top Set: Puente Glúteos (Pesado)', sets:1, reps:'6-10', rest:'2-3 min', rir:'1-2', tip:'Más peso. RIR 1-2.' },
                  { name:'Flexiones Declinadas', sets:3, reps:'10-15', rest:'90s', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Sentadilla Goblet (Pesada)', sets:3, reps:'10-15', rest:'90s', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Face Pulls (con banda)', sets:3, reps:'15-20', rest:'60s', rir:'1-2', tip:'RIR 1-2.' },
                ]
              }
            }
          }
        },
        
        // ====== SEMANA 3: Pico de Rendimiento (RIR 0-1) ======
        3: {
          focus: 'Semana 3: Pico Híbrido (RIR 0-1)',
          dias: ['Día 1: Fuerza Pura (L6)', 'Día 2: Hipertrofia Pura (L5)', 'Día 3: Oxidativo Z2', 'Día 4: Motor/MetCon (L7)', 'Día 5: Híbrido Full Body'],
          workouts: {
            0: { // Día 1: Fuerza (L6)
              gym: { exercises: [
                  { name:'Top Set: Press Banca', sets:1, reps:'2-4', rest:'3-5 min', rir:'1', tip:'¡PR Técnico! RIR 1.' },
                  { name:'Back-Offs: Press Banca', sets:3, reps:'4-6', rest:'2-3 min', rir:'1-2', tip:'Peso de Semana 1-2.' },
                  { name:'Top Set: Remo con Barra', sets:1, reps:'2-4', rest:'3-5 min', rir:'1', tip:'¡PR Técnico! RIR 1.' },
                  { name:'Back-Offs: Remo con Barra', sets:3, reps:'4-6', rest:'2-3 min', rir:'1-2', tip:'Peso de Semana 1-2.' },
                  { name:'Press Militar (barra)', sets:3, reps:'4-6', rest:'2 min', rir:'1', tip:'Pesado, RIR 1.' },
                ]
              },
              casa: { exercises: [
                  { name:'Top Set: Flexiones (Mochila Pesada)', sets:1, reps:'4-6', rest:'2-3 min', rir:'1', tip:'¡PR Técnico! RIR 1.' },
                  { name:'Back-Offs: Flexiones (menos peso)', sets:3, reps:'6-10', rest:'2 min', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Top Set: Remo Invertido (Pies elevados)', sets:1, reps:'4-6', rest:'2-3 min', rir:'1', tip:'¡PR Técnico! RIR 1.' },
                  { name:'Back-Offs: Remo Invertido', sets:3, reps:'6-10', rest:'2 min', rir:'1-2', tip:'RIR 1-2.' },
                  { name:'Pike Push-ups (pies elevados)', sets:3, reps:'5-8', rest:'2 min', rir:'1', tip:'Pesado, RIR 1.' },
                ]
              }
            },
            1: { // Día 2: Hipertrofia (L5)
              gym: { exercises: [
                  { name:'Sentadilla Hack (Tempo 3-1-1-0)', sets:4, reps:'8-10', rest:'90s', rir:'1', tip:'Al fallo técnico (RIR 1).' },
                  { name:'RDL con Mancuernas (Tempo 3-0-1-0)', sets:4, reps:'10-12', rest:'90s', rir:'1', tip:'Al fallo técnico (RIR 1).' },
                  { name:'Myo-Reps: Extensiones Cuádriceps', sets:1, reps:'AMRAP + 5x(AMRAP)', rest:'10-15s', rir:'0', tip:'Serie de activación al fallo, 5 mini-series al fallo.' },
                  { name:'Myo-Reps: Curl Femoral', sets:1, reps:'AMRAP + 5x(AMRAP)', rest:'10-15s', rir:'0', tip:'Serie de activación al fallo, 5 mini-series al fallo.' },
                  { name:'Elevación Talones (Sentado)', sets:3, reps:'AMRAP', rest:'60s', rir:'0', tip:'Al fallo.' },
                ]
              },
              casa: { exercises: [
                  { name:'Sentadilla Búlgara (Tempo 3-1-1-0)', sets:4, reps:'AMRAP c/u', rest:'90s', rir:'1', tip:'Al fallo técnico (RIR 1).' },
                  { name:'RDL a 1 Pierna (Tempo 3-0-1-0)', sets:4, reps:'AMRAP c/u', rest:'75s', rir:'1', tip:'Al fallo técnico (RIR 1).' },
                  { name:'Myo-Reps: Sentadilla Goblet (ligera)', sets:1, reps:'AMRAP + 5x(AMRAP)', rest:'15s', rir:'0', tip:'Al fallo.' },
                  { name:'Curl Nórdico (Negativas)', sets:3, reps:'AMRAP (5-8)', rest:'90s', rir:'0-1', tip:'Al fallo.' },
                  { name:'Elevación Talones 1 Pierna', sets:3, reps:'AMRAP c/u', rest:'45s', rir:'0', tip:'Al fallo.' },
                ]
              }
            },
            2: { // Día 3: Oxidativo Z2
              gym: { cardio: 'Oxidativo Z2: 30-45 min continuo (bike/remo/cinta). Recuperación activa. Ritmo de conversación.' },
              casa:{ cardio: 'Oxidativo Z2: 30-45 min caminata rápida o bici. Ritmo de conversación. Recuperación activa.' }
            },
            3: { // Día 4: Motor/MetCon (L7)
              gym: { exercises: [
                  { 
                    name:'AMRAP 20 Minutos', sets:1, reps:'AMRAP', rest:'N/A', rir:'N/A', tip:'Test: Tantas rondas como sea posible en 20 min.',
                    subExercises: [
                      { name: 'Kettlebell Swings (24/16kg)', reps: '15' },
                      { name: 'Dominadas (o Remo en anillas)', reps: '10' },
                      { name: 'Push Press con Mancuernas', reps: '10' }
                    ]
                  },
                  { name:'Core: Pallof Press', sets:3, reps:'10-12 c/u', rest:'60s', rir:'1', tip:'Pesado.' },
                ]
              },
              casa: { exercises: [
                  { 
                    name:'AMRAP 20 Minutos', sets:1, reps:'AMRAP', rest:'N/A', rir:'N/A', tip:'Test: Tantas rondas como sea posible en 20 min.',
                    subExercises: [
                      { name: 'Swings con Mochila', reps: '15' },
                      { name: 'Remo Invertido', reps: '10' },
                      { name: 'Burpees', reps: '8' }
                    ]
                  },
                  { name:'Core: Pallof Press (banda)', sets:3, reps:'12-15 c/u', rest:'60s', rir:'1' },
                ]
              }
            },
            4: { // Día 5: Híbrido Full Body
              gym: { exercises: [
                  { name:'Top Set: Peso Muerto', sets:1, reps:'2-4', rest:'3-5 min', rir:'1', tip:'¡PR Técnico! RIR 1.' },
                  { name:'Press Inclinado Mancuernas', sets:3, reps:'6-8', rest:'90s', rir:'1', tip:'Pesado, RIR 1.' },
                  { name:'Zancadas con Mancuernas', sets:3, reps:'6-8 c/u', rest:'90s', rir:'1', tip:'Pesado, RIR 1.' },
                  { name:'Face Pulls', sets:3, reps:'12-15', rest:'60s', rir:'1', tip:'Pesado, RIR 1.' },
                ]
              },
              casa: { exercises: [
                  { name:'Top Set: Puente Glúteos (Pesado)', sets:1, reps:'5-8', rest:'2-3 min', rir:'1', tip:'¡PR Técnico! RIR 1.' },
                  { name:'Flexiones Declinadas', sets:3, reps:'8-12', rest:'90s', rir:'1', tip:'Pesado, RIR 1.' },
                  { name:'Sentadilla Goblet (Pesada)', sets:3, reps:'8-12', rest:'90s', rir:'1', tip:'Pesado, RIR 1.' },
                  { name:'Face Pulls (con banda)', sets:3, reps:'12-15', rest:'60s', rir:'1', tip:'Banda más dura.' },
                ]
              }
            }
          }
        },

        // ====== SEMANA 4: Descarga (Deload) ======
        4: {
          focus: 'Semana 4: Descarga y Supercompensación',
          dias: ['Día 1: Full Body Ligero A', 'Día 2: Full Body Ligero B', 'Día 3: Descanso Z2 Suave'],
          workouts: {
            0: { // Día 1: Ligero A
              gym: { exercises: [
                  { name:'Press Banca (sin tempo)', sets:2, reps:'8-10', rest:'90s', rir:'4-5', tip:'50-60% de la Semana 3. Mover sangre.' },
                  { name:'Remo con Barra (sin tempo)', sets:2, reps:'8-10', rest:'90s', rir:'4-5', tip:'Técnica fluida.' },
                  { name:'Press Militar (sin tempo)', sets:2, reps:'8-10', rest:'75s', rir:'4-5', tip:'Ligero y fácil.' },
                ]
              },
              casa: { exercises: [
                  { name:'Flexiones (sin tempo)', sets:2, reps:'12-15', rest:'90s', rir:'4-5', tip:'Fácil, sin peso.' },
                  { name:'Remo Invertido (pies en suelo)', sets:2, reps:'12-15', rest:'75s', rir:'4-5', tip:'Fácil, solo para mover la espalda.' },
                  { name:'Pike Push-ups (pies en suelo)', sets:2, reps:'8-10', rest:'75s', rir:'4-5', tip:'Movimiento ligero.' },
                ]
              }
            },
            1: { // Día 2: Ligero B
              gym: { exercises: [
                  { name:'Sentadilla Goblet (sin tempo)', sets:2, reps:'10-12', rest:'90s', rir:'4-5', tip:'Peso muy ligero. Foco en movilidad.' },
                  { name:'RDL (Mancuernas ligeras)', sets:2, reps:'12-15', rest:'90s', rir:'4-5', tip:'Estiramiento dinámico.' },
                  { name:'Curl Femoral (ligero)', sets:2, reps:'12-15', rest:'75s', rir:'4-5', tip:'Bombeo ligero.' },
                ]
              },
              casa: { exercises: [
                  { name:'Sentadilla Goblet (con libro)', sets:2, reps:'15-20', rest:'90s', rir:'4-5', tip:'Peso simbólico. Foco en la movilidad.' },
                  { name:'RDL a 1 Pierna (sin peso)', sets:2, reps:'12-15 c/u', rest:'75s', rir:'4-5', tip:'Foco en el equilibrio y el estiramiento.' },
                  { name:'Puente de Glúteos (sin peso)', sets:2, reps:'20', rest:'60s', rir:'4-5', tip:'Activación ligera.' },
                ]
              }
            },
            2: { // Día 3: Z2 Suave
              gym: { cardio: 'Oxidativo Z2 Suave: 20-30 min caminata o bici muy ligera. Foco total en recuperación.' },
              casa:{ cardio: 'Descanso activo: 20-30 min caminata suave. Has completado el Método Milón.' }
            }
          }
        }
      }
    };

    // ====== ESTADO Y ELEMENTOS (Sin cambios) ======
    let currentWeek = 1;
    let currentMode = 'gym';
    let currentDayIndex = 0;
    const storageKeyBase = `milonNivel${programData.nivel}`; // Clave única para Nivel 8

    const workoutTitle = document.getElementById('workout-title');
    const introTextContainer = document.getElementById('level-intro-text');
    const weekTabsContainer = document.getElementById('week-tabs');
    const dayTabsContainer = document.getElementById('day-tabs');
    const workoutsContainer = document.getElementById('workouts-container');
    const calendarContainer = document.querySelector('#calendario .flex');

    const openGuideBtn = document.getElementById('open-guide-btn');
    const closeGuideBtn = document.getElementById('close-guide-btn');
    const guideModal = document.getElementById('guide-modal');
    const guideModalTitle = document.getElementById('guide-modal-title');
    const guideMainView = document.getElementById('guide-main-view');
    const guideCarbsView = document.getElementById('guide-carbs-view');
    const showCarbsBtn = document.getElementById('show-carbs-btn');
    const backToGuideBtn = document.getElementById('back-to-guide-btn');

    const openTheoryBtn = document.getElementById('open-theory-btn');
    const closeTheoryBtn = document.getElementById('close-theory-btn');
    const theoryModal = document.getElementById('theory-modal');

    const modeBtnGym = document.getElementById('mode-btn-gym');
    const modeBtnCasa = document.getElementById('mode-btn-casa');

    // ====== FUNCIONES UI (Idénticas a N7) ======
    function setMainMode(mode, save=true){
      currentMode = mode;
      if(save){ localStorage.setItem(`${storageKeyBase}Mode`, mode); }
      updateModeButtons();
      showWorkout(currentDayIndex);
    }
    function updateModeButtons(){
      if(currentMode==='gym'){ modeBtnGym.classList.add('active'); modeBtnCasa.classList.remove('active'); }
      else{ modeBtnCasa.classList.add('active'); modeBtnGym.classList.remove('active'); }
    }
    function loadMainMode(){
      const saved = localStorage.getItem(`${storageKeyBase}Mode`);
      if(saved){ currentMode = saved; }
      updateModeButtons();
    }

    function showWorkoutView(){
      workoutTitle.textContent = programData.titulo;
      introTextContainer.textContent = programData.intro;
      generateWeekTabs(Object.keys(programData.semanas));
      const savedWeek = localStorage.getItem(`${storageKeyBase}Week`);
      showWeek(savedWeek ? parseInt(savedWeek,10) : 1);
    }

    function generateWeekTabs(weeks){
      weekTabsContainer.innerHTML = '';
      weeks.forEach(weekNumber=>{
        const weekData = programData.semanas[weekNumber];
        const tab = document.createElement('button');
        tab.className = 'week-tab py-2 px-4 font-bebas text-lg rounded-t-lg week-tab-inactive';
        tab.innerHTML = `Semana ${weekNumber}<br><span class="text-xs font-normal">${weekData.focus}</span>`;
        tab.onclick = ()=>showWeek(parseInt(weekNumber,10));
        weekTabsContainer.appendChild(tab);
      });
    }

    function showWeek(weekNumber){
      currentWeek = weekNumber;
      localStorage.setItem(`${storageKeyBase}Week`, weekNumber);
      document.querySelectorAll('.week-tab').forEach((tab,idx)=>{
        tab.classList.toggle('week-tab-active', (idx+1)===Number(weekNumber));
        tab.classList.toggle('week-tab-inactive', (idx+1)!==Number(weekNumber));
      });
      const weekData = programData.semanas[weekNumber];
      generateDayTabs(weekData.dias);
      generateCalendar(weekData.dias);
      const savedDay = localStorage.getItem(`${storageKeyBase}Day_w${currentWeek}`);
      showWorkout(savedDay ? parseInt(savedDay,10) : 0);
    }

    function generateDayTabs(days){
      dayTabsContainer.innerHTML = '';
      days.forEach((day,index)=>{
        const tab = document.createElement('button');
        tab.className = 'day-tab py-2 px-4 font-bebas text-md rounded-lg m-1 day-tab-inactive';
        tab.textContent = day;
        tab.onclick = ()=>showWorkout(index);
        dayTabsContainer.appendChild(tab);
      });
    }

    function showWorkout(dayIndex){
      currentDayIndex = dayIndex;
      localStorage.setItem(`${storageKeyBase}Day_w${currentWeek}`, dayIndex);
      document.querySelectorAll('.day-tab').forEach((tab,idx)=>{
        tab.classList.toggle('day-tab-active', idx===dayIndex);
        tab.classList.toggle('day-tab-inactive', idx!==dayIndex);
      });

      const weekWorkouts = programData.semanas[currentWeek].workouts || {};
      const node = weekWorkouts[dayIndex];
      const dayData = node ? node[currentMode] : null;

      workoutsContainer.innerHTML = '';

      if(!dayData || (!dayData.exercises && !dayData.cardio)){
        workoutsContainer.innerHTML = '<p class="text-center text-gray-500">No hay rutina para este modo o día.</p>';
        return;
      }

      if(dayData.exercises){
        dayData.exercises.forEach((ex,exIndex)=>{
          // No renderizar ejercicios con sets 0 (ocultos)
          if (ex.sets === 0) return;

          const uniqueId = `prog-${programData.nivel}-w${currentWeek}-d${dayIndex}-m${currentMode}-${exIndex}`;
          const setsCheckboxes = Array.from({length: ex.sets || 0},(_,i)=>(
            `<div class="flex items-center">
               <input type="checkbox" id="set-${uniqueId}-${i}" class="set-checkbox h-4 w-4 rounded bg-gray-100 border-gray-300 text-amber-500 focus:ring-amber-600">
               <label for="set-${uniqueId}-${i}" class="ml-2 text-sm text-gray-600">Serie ${i+1}</label>
             </div>`
          )).join('');

          const div = document.createElement('div');
          div.className = 'bg-white border border-gray-200 p-5 rounded-lg shadow-sm';
          div.innerHTML = `
            <div class="flex justify-between items-start flex-wrap gap-4">
              <div>
                <h4 class="text-2xl text-gray-900">${ex.name}</h4>
                <p class="text-amber-600 font-semibold text-sm mt-1">${ex.sets||'N/A'} series x ${ex.reps||'N/A'} reps</p>
                <p class="text-gray-600 text-xs mt-1">${ex.rest?`Desc: ${ex.rest}`:''} ${ex.rir?`| RIR: ${ex.rir}`:''}</p>
                <div class="mt-2 flex items-center gap-2">
                  <label for="weight-${uniqueId}" class="text-sm font-semibold text-gray-500">Peso:</label>
                  <input type="text" id="weight-${uniqueId}" class="weight-input w-24 rounded-md border-gray-300 shadow-sm text-sm focus:ring-amber-500 focus:border-amber-500" placeholder="ej: 100kg">
                </div>
              </div>
              <div class="flex space-x-3">${setsCheckboxes}</div>
            </div>
            ${ex.tip ? `<p class="text-sm mt-3 pt-3 border-t border-gray-200 text-gray-600"><strong>Técnica clave:</strong> ${ex.tip}</p>` : ''}`;
          
          // Lógica para renderizar sub-ejercicios (MetCons, EMOMs, Myo-Reps)
          if (ex.subExercises && ex.subExercises.length > 0) {
            const subList = document.createElement('ul');
            subList.className = 'mt-4 pl-5 border-l-2 border-amber-300 space-y-3';
            
            ex.subExercises.forEach(subEx => {
              const item = document.createElement('li');
              item.className = 'text-sm';
              item.innerHTML = `
                <strong class="text-gray-800">${subEx.name}</strong>
                <span class="text-amber-600 font-medium ml-2">${subEx.reps}</span>
                ${subEx.tip ? `<p class="text-xs text-gray-500">${subEx.tip}</p>` : ''}
              `;
              subList.appendChild(item);
            });
            
            div.appendChild(subList);
          }

          workoutsContainer.appendChild(div);
        });
      }

      if(dayData.cardio){
        workoutsContainer.insertAdjacentHTML('beforeend', `
          <div class="bg-white border-2 border-dashed border-amber-400 p-5 rounded-lg mt-6">
            <div class="flex items-center gap-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-amber-500 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/></svg>
              <div>
                <h4 class="text-2xl text-gray-900">Bloque Oxidativo</h4>
                <p class="text-gray-700 mt-1">${dayData.cardio}</p>
              </div>
            </div>
          </div>
        `);
      }

      loadAndSaveProgress();
    }

    function generateCalendar(days){
      calendarContainer.innerHTML = '';
      const wrap = document.createElement('div');
      wrap.className = 'bg-white border border-gray-200 p-4 rounded-lg w-full max-w-2xl';
      wrap.innerHTML = `<h3 class="text-xl text-gray-900 text-center mb-4">Progreso Semana ${currentWeek}</h3>`;

      const grid = document.createElement('div');
      grid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 text-center';

      days.forEach((day, idx)=>{
        const dayEl = document.createElement('div');
        const dayName = day.split(':')[0];
        const dayId = `cal-${storageKeyBase}-w${currentWeek}-d${idx}`;
        dayEl.id = dayId;
        dayEl.className = 'calendar-day bg-gray-200 p-3 rounded-md cursor-pointer border-2 border-transparent hover:border-amber-500 transition-all font-semibold';
        dayEl.textContent = dayName;
        if(localStorage.getItem(dayId)==='true'){ dayEl.classList.add('day-checked'); }
        dayEl.addEventListener('click', ()=>{
          dayEl.classList.toggle('day-checked');
          localStorage.setItem(dayId, dayEl.classList.contains('day-checked'));
        });
        grid.appendChild(dayEl);
      });

      wrap.appendChild(grid);
      calendarContainer.appendChild(wrap);
    }

    function loadAndSaveProgress(){
      document.querySelectorAll('.set-checkbox').forEach(cb=>{
        if(localStorage.getItem(cb.id)==='true'){ cb.checked = true; }
        cb.addEventListener('change', ()=> localStorage.setItem(cb.id, cb.checked));
      });
      document.querySelectorAll('.weight-input').forEach(inp=>{
        inp.value = localStorage.getItem(inp.id) || '';
        inp.addEventListener('input', ()=> localStorage.setItem(inp.id, inp.value));
      });
    }

    function openModal(modal){
      modal.classList.remove('hidden'); modal.classList.add('flex');
      setTimeout(()=> modal.querySelector('.bg-black').classList.remove('opacity-0'),10);
      setTimeout(()=> modal.querySelector('.transform').classList.remove('scale-95'),10);
    }
    function closeModal(modal){
      modal.querySelector('.transform').classList.add('scale-95');
      modal.querySelector('.bg-black').classList.add('opacity-0');
      setTimeout(()=> modal.classList.add('hidden'),300);
    }

    // ====== INIT ======
    document.addEventListener('DOMContentLoaded', ()=>{
      loadMainMode();
      showWorkoutView();

      modeBtnGym.addEventListener('click', ()=>setMainMode('gym'));
      modeBtnCasa.addEventListener('click', ()=>setMainMode('casa'));

      // Guía
      openGuideBtn.addEventListener('click', ()=>{
        guideModalTitle.textContent = 'Guía Esencial Nivel 8';
        guideMainView.classList.remove('hidden');
        guideCarbsView.classList.add('hidden');
        openModal(guideModal);
      });
      closeGuideBtn.addEventListener('click', ()=>closeModal(guideModal));
      document.getElementById('guide-modal-overlay').addEventListener('click', ()=>closeModal(guideModal));
      document.getElementById('theory-modal-overlay').addEventListener('click', ()=>closeModal(theoryModal));

      document.getElementById('open-theory-btn').addEventListener('click', ()=>openModal(theoryModal));
      document.getElementById('close-theory-btn').addEventListener('click', ()=>closeModal(theoryModal));

      document.getElementById('show-carbs-btn').addEventListener('click', ()=>{
        guideModalTitle.textContent = 'Ideas de Carbohidratos';
        guideMainView.classList.add('hidden');
        guideCarbsView.classList.remove('hidden');
      });
      document.getElementById('back-to-guide-btn').addEventListener('click', ()=>{
        guideModalTitle.textContent = 'Guía Esencial Nivel 8';
        guideCarbsView.classList.add('hidden');
        guideMainView.classList.remove('hidden');
      });
    });
  </script>
</body>
</html>